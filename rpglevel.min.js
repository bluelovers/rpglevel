!function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b},c=[].slice;!function(){var a;return a=function(){function a(){this._exp=0,this._necessaryExps=[],this._minLevel=1,this._cachedLevelStatuses=null}var d;return a.VERSION="0.9.0",a.InvalidArgsError=d=function(a){function c(a){this.message=a,this.name="InvalidArgsError",c.__super__.constructor.apply(this,arguments)}return b(c,a),c}(Error),a.prototype._extend=function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},a.prototype.defineExpTable=function(){var a;if(a=1<=arguments.length?c.call(arguments,0):[],this._necessaryExps=a[0]instanceof Array?a[0]:this._generateNecessaryExps(a[0],a[1]),0!==this._necessaryExps[0])throw new d("Invalid Exp-Table.")},a.prototype._generateNecessaryExps=function(a,b){var c,d;return null==b&&(b={}),d=this._extend({startLevel:1,maxLevel:99},b),this._necessaryExps=function(){var b,e,f,g;for(g=[],c=b=e=this._minLevel,f=d.maxLevel;f>=e?f>=b:b>=f;c=f>=e?++b:--b)c<=d.startLevel?g.push(0):g.push(a(c,{minLevel:this._minLevel,startLevel:d.startLevel,maxLevel:d.maxLevel}));return g}.call(this)},a.prototype.getMinLevel=function(){return this._minLevel},a.prototype.getMaxLevel=function(){return this._necessaryExps.length},a.prototype.getStartLevel=function(){var a,b,c;c=this._necessaryExps;for(a in c)if(b=c[a],b>0)return parseInt(a,10)},a.prototype._getIndexByLevel=function(a){return a-1},a.prototype._getLevelByIndex=function(a){return parseInt(a,10)+1},a.prototype.getExp=function(){return this._exp},a.prototype.getTotalNecessaryExp=function(a,b){var c,d,e,f,g;for(e=0,d=f=g=a+1;b>=g?b>=f:f>=b;d=b>=g?++f:--f)c=this._getIndexByLevel(d),e+=this._necessaryExps[c];return e},a.prototype.getNecessaryExpByLevel=function(a){return this._necessaryExps[this._getIndexByLevel(a)]},a.prototype.getMaxExp=function(){return this.getTotalNecessaryExp(this.getMinLevel(),this.getMaxLevel())},a.prototype._updateExp=function(a){var b,c;return c=this.getLevel(),this._exp=this._exp+a,this._exp>this.getMaxExp()?this._exp=this.getMaxExp():this._exp<0&&(this._exp=0),this._cachedLevelStatuses=null,b=this.getLevel(),[c,b]},a.prototype.gainExp=function(a){var b,c,d;return d=this._updateExp(a),c=d[0],b=d[1],b-c},a.prototype.drainExp=function(a){var b,c,d;return d=this._updateExp(-a),c=d[0],b=d[1],b-c},a.prototype.gainLevel=function(a){var b,c,d;return c=this.getLevel(),d=c+a,d>this.getMaxLevel()&&(d=this.getMaxLevel()),b=this.getTotalNecessaryExp(this.getMinLevel(),d)-this.getExp(),this.gainExp(b)},a.prototype.drainLevel=function(a){var b,c;return c=this.getLevel()-a,0>c&&(c=0),b=this.getExp()-this.getTotalNecessaryExp(this.getMinLevel(),c+1),this.drainExp(b+1)},a.prototype._hasCachedLevelStatuses=function(){return null!==this._cachedLevelStatuses},a.prototype.getStatuses=function(){var a,b,c,d,e,f,g,h,i;if(this._hasCachedLevelStatuses())return this._extend({},this._cachedLevelStatuses);e=0,h=0,f=0,b=0,i=this._necessaryExps;for(c in i){if(a=i[c],d=this._getLevelByIndex(c),h+=a,!(this._exp>=h)){f=a,b=this._exp-(h-a);break}e=d}return g={level:e,necessaryExpForNext:f,gainedExpForNext:b,lackExpForNext:f-b},this._cachedLevelStatuses=this._extend({},g),g},a.prototype.getLevel=function(){return this.getStatuses().level},a.prototype.isMaxLevel=function(){return this.getLevel()===this.getMaxLevel()},a}(),"undefined"!=typeof module?module.exports=a:window.RPGLevel=a}()}.call(this);