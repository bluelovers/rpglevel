!function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},d=[].slice;!function(){var b;return b=function(){function b(){this._exp=0,this._necessaryExps=[],this._minLevel=1,this._cachedLevelStatuses=null}var e;return b.VERSION="1.0.0",b.PRESET_EXP_TABLE_DEFINITIONS={wiz_like:[function(b,c){var d;return 2===b?1e3:a.call([3,4,5,6,7,8,9,10,11,12,13,14],b)>=0?(d=1.72414*c.previousTotalExp,parseInt(d-c.previousTotalExp,10)):c.exps[13]}]},b.InvalidArgsError=e=function(a){function b(a){this.message=a,this.name="InvalidArgsError",b.__super__.constructor.apply(this,arguments)}return c(b,a),b}(Error),b.prototype._extend=function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},b.prototype.defineExpTable=function(){var a,b;if(a=1<=arguments.length?d.call(arguments,0):[],a[0]instanceof Array?this._necessaryExps=a[0]:"string"==typeof a[0]?(b=this._getExpTableDefinition(a[0]),this._necessaryExps=this._generateNecessaryExps.apply(this,b)):this._necessaryExps=this._generateNecessaryExps(a[0],a[1]),0!==this._necessaryExps[0])throw new e("Invalid Exp-Table.")},b.prototype._generateNecessaryExps=function(a,b){var c,d,e,f,g,h,i;return null==b&&(b={}),g=this._extend({startLevel:1,maxLevel:99},b),d=[],h=0,i=0,f={},this._necessaryExps=function(){var b,j,k,l;for(l=[],e=b=j=this._minLevel,k=g.maxLevel;k>=j?k>=b:b>=k;e=k>=j?++b:--b)e<=g.startLevel?c=0:(c=a(e,{self:this,minLevel:this._minLevel,startLevel:g.startLevel,maxLevel:g.maxLevel,levelDelta:g.maxLevel-g.startLevel,exps:d,previousExp:h,previousTotalExp:i,memo:f}),h=c,i+=c),d.push(c),l.push(c);return l}.call(this)},b.prototype._getExpTableDefinition=function(a){if(a in b.PRESET_EXP_TABLE_DEFINITIONS)return b.PRESET_EXP_TABLE_DEFINITIONS[a];throw new e("Not found Exp-Table, key="+a)},b.prototype.getMinLevel=function(){return this._minLevel},b.prototype.getMaxLevel=function(){return this._necessaryExps.length},b.prototype.getStartLevel=function(){var a,b,c;c=this._necessaryExps;for(a in c)if(b=c[a],b>0)return parseInt(a,10)},b.prototype._getIndexByLevel=function(a){return a-1},b.prototype._getLevelByIndex=function(a){return parseInt(a,10)+1},b.prototype.getExp=function(){return this._exp},b.prototype.getTotalNecessaryExp=function(a,b){var c,d,e,f,g;for(e=0,d=f=g=a+1;b>=g?b>=f:f>=b;d=b>=g?++f:--f)c=this._getIndexByLevel(d),e+=this._necessaryExps[c];return e},b.prototype.getNecessaryExpByLevel=function(a){return this._necessaryExps[this._getIndexByLevel(a)]},b.prototype.getMaxExp=function(){return this.getTotalNecessaryExp(this.getMinLevel(),this.getMaxLevel())},b.prototype.setExp=function(a){return this._exp=parseInt(a,10),this._cleanCaches()},b.prototype.resetExp=function(){return this.setExp(0)},b.prototype._updateExp=function(a){var b,c,d;return c=this.getLevel(),d=this._exp+a,d>this.getMaxExp()?d=this.getMaxExp():0>d&&(d=0),this.setExp(d),b=this.getLevel(),[c,b]},b.prototype.gainExp=function(a){var b,c,d;return d=this._updateExp(a),c=d[0],b=d[1],b-c},b.prototype.drainExp=function(a){var b,c,d;return d=this._updateExp(-a),c=d[0],b=d[1],b-c},b.prototype.gainLevel=function(a){var b,c,d;return c=this.getLevel(),d=c+a,d>this.getMaxLevel()&&(d=this.getMaxLevel()),b=this.getTotalNecessaryExp(this.getMinLevel(),d)-this.getExp(),this.gainExp(b)},b.prototype.drainLevel=function(a){var b,c;return c=this.getLevel()-a,0>c&&(c=0),b=this.getExp()-this.getTotalNecessaryExp(this.getMinLevel(),c+1),this.drainExp(b+1)},b.prototype._hasCachedLevelStatuses=function(){return null!==this._cachedLevelStatuses},b.prototype._cleanCaches=function(){return this._cachedLevelStatuses=null},b.prototype.getStatuses=function(){var a,b,c,d,e,f,g,h,i;if(this._hasCachedLevelStatuses())return this._extend({},this._cachedLevelStatuses);e=0,h=0,f=0,b=0,i=this._necessaryExps;for(c in i){if(a=i[c],d=this._getLevelByIndex(c),h+=a,!(this._exp>=h)){f=a,b=this._exp-(h-a);break}e=d}return g={level:e,necessaryExpForNext:f,gainedExpForNext:b,lackExpForNext:f-b},this._cachedLevelStatuses=this._extend({},g),g},b.prototype.getLevel=function(){return this.getStatuses().level},b.prototype.isMaxLevel=function(){return this.getLevel()===this.getMaxLevel()},b}(),"undefined"!=typeof module?module.exports=b:window.RPGLevel=b}()}.call(this);